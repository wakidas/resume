---
// ビルド時にOGP画像を取得する関数
async function fetchOgpAtBuildTime(url) {
  // 既知のOGP画像をハードコード（CORS回避のため）
  const knownImages = {
    'https://paytner.hatenablog.com/entry/2024/02/29/191400':
      'https://pbs.twimg.com/card_img/1933842913198215168/6K37rpwc?format=jpg&name=medium',
    'https://paytner.hatenablog.com/entry/developer-productivity-adcale-20231218':
      'https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png', // デフォルトを明示的に設定
    'https://paytner.hatenablog.com/entry/em-adcale-20231223': 
      'https://cdn-ak.f.st-hatena.com/images/fotolife/w/wakidas/20231125/20231125175617.png',
    'https://paytner.hatenablog.com/entry/2023/12/21/194132':
      'https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png', // デフォルトを明示的に設定
    'https://paytner.hatenablog.com/entry/developer-productivity-adcale-20221216':
      'https://cdn-ak.f.st-hatena.com/images/fotolife/w/wakidas/20250620/20250620001428.png',
    'https://paytner.hatenablog.com/entry/em-adcale-20221215':
      'https://m.media-amazon.com/images/I/41kjaDTnOfL._SL500_.jpg',
    'https://paytner.hatenablog.com/entry/2022/06/29/175422':
      'https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png' // デフォルトを明示的に設定
  };
  
  // URLが既知のものであればその画像を返す
  for (const [pattern, image] of Object.entries(knownImages)) {
    if (url.includes(pattern)) {
      return image;
    }
  }
  
  // その他のはてなブログ記事はデフォルトサムネイル
  if (url.includes('paytner.hatenablog.com')) {
    return 'https://cdn.blog.st-hatena.com/images/theme/og-image-1500.png';
  }
  
  return null;
}

// アウトプットデータを構造化（動的サムネイル取得対応）
const outputData = [
  {
    id: 'paytner',
    title: 'ペイトナー テックブログ',
    url: 'https://paytner.hatenablog.com/archive/author/wakidas',
    articles: [
      { 
        title: 'チームの全体定例をやめてみた話', 
        url: 'https://paytner.hatenablog.com/entry/2024/02/29/191400',
        thumbnail: await fetchOgpAtBuildTime('https://paytner.hatenablog.com/entry/2024/02/29/191400')
      },
      { 
        title: 'フィーチャーフラグ、レビュープレフィックス、そしてAIレビューまで', 
        url: 'https://paytner.hatenablog.com/entry/developer-productivity-adcale-20231218',
        thumbnail: await fetchOgpAtBuildTime('https://paytner.hatenablog.com/entry/developer-productivity-adcale-20231218')
      },
      { 
        title: '目標設定によりチームに戦略マネジメントが生まれた', 
        url: 'https://paytner.hatenablog.com/entry/em-adcale-20231223',
        thumbnail: await fetchOgpAtBuildTime('https://paytner.hatenablog.com/entry/em-adcale-20231223')
      },
      { 
        title: 'AIレビュー、実際使ってみてどうなん？', 
        url: 'https://paytner.hatenablog.com/entry/2023/12/21/194132',
        thumbnail: await fetchOgpAtBuildTime('https://paytner.hatenablog.com/entry/2023/12/21/194132')
      },
      { 
        title: 'コード品質？レビュー効率？いや、PR数だ！！！', 
        url: 'https://paytner.hatenablog.com/entry/developer-productivity-adcale-20221216',
        thumbnail: await fetchOgpAtBuildTime('https://paytner.hatenablog.com/entry/developer-productivity-adcale-20221216')
      },
      { 
        title: 'マネジメントの型」がある会社にEMとして入社しました', 
        url: 'https://paytner.hatenablog.com/entry/em-adcale-20221215',
        thumbnail: await fetchOgpAtBuildTime('https://paytner.hatenablog.com/entry/em-adcale-20221215')
      },
      { 
        title: '初心者3人でペアプロ始めたら、想像以上にメリットだらけだった', 
        url: 'https://paytner.hatenablog.com/entry/2022/06/29/175422',
        thumbnail: await fetchOgpAtBuildTime('https://paytner.hatenablog.com/entry/2022/06/29/175422')
      }
    ]
  },
  {
    id: 'personal-blog',
    title: '個人ブログ',
    url: 'https://note.com/wakidas',
    description: '読書録メイン',
    articles: [
      { 
        title: 'EMConf JP 2025 参加レポ', 
        url: 'https://note.com/wakidas/n/n1a70da47add7',
        thumbnail: 'https://pbs.twimg.com/card_img/1935680090509344768/O3r2PgBP?format=jpg&name=medium'
      },
      { 
        title: '内発的動機づけを育む ~ 『教育心理学概論』より ~', 
        url: 'https://note.com/wakidas/n/n245800b91692',
        thumbnail: 'https://pbs.twimg.com/card_img/1933627490326704128/tITWKAwI?format=jpg&name=medium'
      },
      { 
        title: '2024年読書まとめ', 
        url: 'https://note.com/wakidas/n/ned980a755274',
        thumbnail: 'https://pbs.twimg.com/card_img/1933627490855157760/Ik5a0PIA?format=jpg&name=medium'
      },
      { 
        title: '『死ぬ時に後悔すること25』読んだ', 
        url: 'https://note.com/wakidas/n/nfaa81cc90901',
        thumbnail: 'https://pbs.twimg.com/card_img/1933627498295930883/oa6FSg-B?format=jpg&name=900x900'
      },
      { 
        title: '育成のカギは「教える」ではなく「真似してもらう」', 
        url: 'https://note.com/wakidas/n/n36108d011330',
        thumbnail: 'https://pbs.twimg.com/card_img/1935739805952098304/Q-0oKXUq?format=jpg&name=medium'
      }
    ]
  },
  {
    id: 'qiita',
    title: 'Qiita',
    url: 'https://qiita.com/shimpeee_',
    articles: [
      { 
        title: '【Laravel テスト】フォームリクエスト 複数項目バリデーションのテストコード', 
        url: 'https://qiita.com/kiwatchi1991/items/fd0e9cfae0e1bdcf1121',
        thumbnail: 'https://pbs.twimg.com/card_img/1935744152534499328/LVSXCDwS?format=jpg&name=medium'
      },
      { 
        title: '【5分でざっくり理解！】Laravelでクリーンアーキテクチャ超入門', 
        url: 'https://qiita.com/kiwatchi1991/items/cd3be76d70f6dfb1f366',
        thumbnail: '/resume/images/qiita/laravel-clean-architecture.png'
      },
      { 
        title: '【VSCode】ES6記法スニペットのEmmet展開方法まとめ', 
        url: 'https://qiita.com/kiwatchi1991/items/75f337628b3cbd9a4e32',
        thumbnail: 'https://pbs.twimg.com/card_img/1935744982012641280/H2q1v24l?format=jpg&name=medium'
      }
    ]
  }
];
---

<section class="output-section">
  <h2 class="section-title">アウトプット</h2>
  
  <div class="platforms-container">
    {outputData.map((platform) => (
      <div class="platform-section">
        <div class="platform-header">
          <h3 class="platform-title">{platform.title}</h3>
          <a href={platform.url} target="_blank" rel="noopener noreferrer" class="platform-link">
            {platform.url}
          </a>
        </div>
        
        {platform.description && (
          <p class="platform-description">{platform.description}</p>
        )}
        
        {platform.stats && (
          <div class="platform-stats">{platform.stats}</div>
        )}
        
        <div class="thumbnails-carousel">
          <div class="thumbnails-track" data-platform={platform.id}>
            {platform.articles && platform.articles.map((article, index) => (
              <div class="thumbnail-card">
                <a href={article.url} target="_blank" rel="noopener noreferrer" class="thumbnail-link">
                  <div class="thumbnail-image">
                    <img 
                      class="thumbnail-img" 
                      src={article.thumbnail} 
                      alt={article.title} 
                      loading="lazy"
                    />
                  </div>
                  <div class="thumbnail-content">
                    <h4 class="thumbnail-title">{article.title}</h4>
                  </div>
                </a>
              </div>
            ))}
          </div>
        </div>
      </div>
    ))}
  </div>
</section>

<style>
  .section-title {
    @apply text-2xl font-bold text-gray-100 mb-8 text-center;
  }

  .platforms-container {
    @apply space-y-12;
  }

  .platform-section {
    @apply mb-8;
  }

  .platform-header {
    @apply mb-4;
  }

  .platform-title {
    @apply text-lg font-bold bg-gradient-to-r from-emerald-400 to-green-500 bg-clip-text text-transparent mb-2;
    margin: 0;
  }

  .platform-link {
    @apply text-green-400 text-sm no-underline hover:underline;
  }

  .platform-description {
    @apply text-gray-300 text-sm mb-4;
  }

  .platform-stats {
    @apply text-emerald-400 font-medium text-sm bg-emerald-400/10 px-3 py-2 rounded-lg mb-4 w-fit;
  }

  .thumbnails-carousel {
    @apply relative overflow-hidden;
  }

  .thumbnails-track {
    @apply flex gap-4 overflow-x-auto scroll-smooth pb-4;
    scroll-snap-type: x mandatory;
    scrollbar-width: thin;
    scrollbar-color: rgba(16, 185, 129, 0.3) transparent;
  }

  .thumbnails-track::-webkit-scrollbar {
    height: 6px;
  }

  .thumbnails-track::-webkit-scrollbar-track {
    background: rgba(51, 65, 85, 0.3);
    border-radius: 3px;
  }

  .thumbnails-track::-webkit-scrollbar-thumb {
    background: rgba(16, 185, 129, 0.5);
    border-radius: 3px;
  }

  .thumbnails-track::-webkit-scrollbar-thumb:hover {
    background: rgba(16, 185, 129, 0.7);
  }

  .thumbnail-card {
    @apply flex-none w-72 rounded-2xl overflow-hidden border border-gray-700/30 transition-all duration-300 hover:border-emerald-500/50;
    scroll-snap-align: start;
    background: linear-gradient(135deg, 
      rgba(51, 65, 85, 0.6) 0%,
      rgba(71, 85, 105, 0.5) 25%,
      rgba(30, 41, 59, 0.4) 50%,
      rgba(51, 65, 85, 0.3) 75%,
      rgba(71, 85, 105, 0.2) 100%);
    backdrop-filter: blur(20px);
    box-shadow: 
      0 4px 20px rgba(0,0,0,0.3),
      0 0 0 1px rgba(255,255,255,0.1),
      inset 0 1px 0 rgba(255,255,255,0.15);
  }

  .thumbnail-card:hover {
    transform: translateY(-2px);
    box-shadow: 
      0 8px 32px rgba(0,0,0,0.4),
      0 0 0 1px rgba(16, 185, 129, 0.3),
      inset 0 1px 0 rgba(255,255,255,0.2);
  }

  .thumbnail-link {
    @apply block no-underline text-gray-100;
  }

  .thumbnail-image {
    @apply relative h-32 bg-gray-700 overflow-hidden;
  }

  .thumbnail-img {
    @apply w-full h-full object-cover transition-transform duration-300;
  }

  .thumbnail-card:hover .thumbnail-img {
    transform: scale(1.05);
  }

  .thumbnail-content {
    @apply p-4;
  }

  .thumbnail-title {
    @apply text-sm font-medium text-gray-100 leading-snug mb-2 line-clamp-2;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin: 0;
  }

  /* レスポンシブ対応 */
  @media (max-width: 768px) {
    .thumbnail-card {
      @apply w-64;
    }
    
    .thumbnail-image {
      @apply h-28;
    }
    
    .thumbnail-content {
      @apply p-3;
    }
    
    .thumbnail-title {
      @apply text-xs;
    }
  }

  @media (max-width: 480px) {
    .thumbnail-card {
      @apply w-56;
    }
    
    .thumbnails-track {
      @apply gap-3;
    }
  }
</style>

<script>
  // カルーセル初期化
  document.addEventListener('DOMContentLoaded', function() {
    console.log('サムネイル付きカルーセル初期化完了');
  });
</script>
